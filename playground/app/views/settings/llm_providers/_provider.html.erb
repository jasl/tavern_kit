<%# Provider card for index listing %>
<%# locals: provider:, default_provider: %>
<div id="provider-<%= provider.id %>"
     class="card bg-base-100 shadow-sm border border-base-300"
     data-controller="llm-settings"
     data-llm-settings-provider-id-value="<%= provider.id %>">
  <div class="card-body p-4">
    <!-- Header -->
    <div class="flex items-start justify-between gap-2">
      <div class="min-w-0">
        <h3 class="card-title text-lg flex items-center gap-2">
          <%= link_to provider.name, edit_settings_llm_provider_path(provider), class: "hover:text-primary transition-colors truncate" %>
          <% if default_provider && provider.id == default_provider.id %>
            <span class="badge badge-primary badge-sm gap-1">
              <span class="icon-[lucide--star] size-3"></span>
              Default
            </span>
          <% end %>
          <% if provider.disabled? %>
            <span class="badge badge-warning badge-sm"><%= t("llm_providers.status.disabled", default: "Disabled") %></span>
          <% end %>
          <% if provider.last_tested_at.present? %>
            <span class="badge badge-success badge-sm badge-outline" title="<%= t("llm_providers.fields.last_tested") %>: <%= time_ago_in_words(provider.last_tested_at) %> ago">
              <%= t("llm_providers.status.tested") %>
            </span>
          <% end %>
        </h3>
      </div>
      <div class="flex items-center gap-2 shrink-0">
        <%= link_to edit_settings_llm_provider_path(provider), class: "btn btn-sm btn-ghost gap-1" do %>
          <span class="icon-[lucide--pencil] size-4"></span>
          <%= t("llm_providers.actions.edit") %>
        <% end %>
      </div>
    </div>

    <!-- Provider Details -->
    <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      <div>
        <span class="text-base-content/60"><%= t("llm_providers.fields.base_url") %>:</span>
        <span class="font-mono text-sm ml-2 break-all"><%= provider.base_url %></span>
      </div>
      <div>
        <span class="text-base-content/60"><%= t("llm_providers.fields.model") %>:</span>
        <span class="font-mono text-sm ml-2"><%= provider.model.presence || t("llm_providers.fields.not_set") %></span>
      </div>
      <div>
        <span class="text-base-content/60"><%= t("llm_providers.fields.api_key") %>:</span>
        <span class="ml-2">
          <% if provider.api_key.present? %>
            <span class="text-success"><%= t("llm_providers.fields.api_key_set") %></span>
          <% else %>
            <span class="text-base-content/40"><%= t("llm_providers.fields.api_key_not_set") %></span>
          <% end %>
        </span>
      </div>
      <div>
        <span class="text-base-content/60"><%= t("llm_providers.fields.streaming") %>:</span>
        <span class="ml-2">
          <% if provider.streamable? %>
            <span class="icon-[lucide--check] size-4 text-success"></span>
          <% else %>
            <span class="icon-[lucide--x] size-4 text-base-content/40"></span>
          <% end %>
        </span>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="mt-3 pt-3 border-t border-base-200 flex items-center justify-between">
      <div class="flex flex-wrap gap-2">
        <%# Test Connection %>
        <button
          type="button"
          class="btn btn-sm btn-outline gap-2"
          data-action="click->llm-settings#testConnection"
          data-llm-settings-target="testButton"
        >
          <span class="icon-[lucide--wifi] size-4" data-llm-settings-target="testIcon"></span>
          <span data-llm-settings-target="testText"><%= t("llm_providers.actions.test") %></span>
        </button>

        <%# Set Default %>
        <% unless (default_provider && provider.id == default_provider.id) || provider.disabled? %>
          <%= button_to set_default_settings_llm_provider_path(provider),
              method: :post,
              class: "btn btn-sm btn-ghost gap-1",
              form: { data: { turbo_confirm: t("llm_providers.set_default.confirm", name: provider.name) } } do %>
            <span class="icon-[lucide--star] size-4"></span>
            <%= t("llm_providers.actions.set_default") %>
          <% end %>
        <% end %>
      </div>

      <%# Delete button %>
      <% is_default = default_provider && provider.id == default_provider.id %>
      <% if is_default %>
        <button type="button" class="btn btn-sm btn-ghost text-base-content/30 gap-2" disabled title="<%= t("llm_providers.cannot_delete_default", default: "Cannot delete the default provider.") %>">
          <span class="icon-[lucide--trash-2] size-4"></span>
          <%= t("common.delete", default: "Delete") %>
        </button>
      <% else %>
        <%= button_to settings_llm_provider_path(provider),
              method: :delete,
              form: { data: { turbo_confirm: t("llm_providers.delete_confirm", default: "Are you sure you want to delete this provider?") } },
              class: "btn btn-sm btn-ghost text-error gap-2" do %>
          <span class="icon-[lucide--trash-2] size-4"></span>
          <%= t("common.delete", default: "Delete") %>
        <% end %>
      <% end %>
    </div>

    <!-- Connection Status -->
    <div id="connection-status-<%= provider.id %>" class="mt-3">
      <%= render "settings/llm_providers/connection_status", result: nil, provider: provider %>
    </div>
  </div>
</div>
