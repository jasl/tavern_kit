<%# Entry Row - Compact display in list %>
<%# locals: (entry:, lorebook:) %>
<% card_class = entry.enabled ? "card bg-base-200 shadow-sm" : "card bg-base-200/50 shadow-sm opacity-60" %>
<%= tag.div id: dom_id(entry), class: card_class, data: { sortable_item: "", entry_id: entry.id } do %>
  <div class="card-body p-3">
    <div class="flex items-start gap-3">
      <%# Drag Handle %>
      <div class="cursor-grab text-base-content/30 hover:text-base-content/50 pt-1" data-sortable-handle="">
        <span class="icon-[lucide--grip-vertical] size-4"></span>
      </div>

      <%# Toggle & Status %>
      <div class="flex flex-col items-center gap-1">
        <%= form_with url: settings_lorebook_entry_path(lorebook, entry), method: :patch, class: "inline", data: { controller: "auto-submit", turbo_stream: true } do %>
          <input type="hidden" name="lorebook_entry[enabled]" value="0">
          <input type="checkbox"
                 name="lorebook_entry[enabled]"
                 value="1"
                 class="toggle toggle-sm toggle-primary"
                 <%= "checked" if entry.enabled %>
                 data-action="change->auto-submit#submit">
        <% end %>
        <% if entry.constant %>
          <span class="badge badge-xs badge-warning" title="<%= t("lorebook_entries.constant_hint", default: "Always active") %>">C</span>
        <% end %>
      </div>

      <%# Content Preview %>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 mb-1">
          <span class="font-medium text-sm truncate"><%= entry.display_name %></span>
          <span class="badge badge-xs badge-ghost">
            <%= entry.position.humanize %>
          </span>
          <% if entry.probability < 100 %>
            <span class="badge badge-xs badge-outline" title="<%= t("lorebook_entries.probability_hint", default: "Activation probability") %>">
              <%= entry.probability %>%
            </span>
          <% end %>
        </div>

        <div class="flex flex-wrap gap-1 mb-1">
          <% entry.keys&.first(5)&.each do |key| %>
            <span class="badge badge-xs <%= key.start_with?('/') ? 'badge-secondary' : 'badge-primary' %> badge-outline">
              <%= key.truncate(20) %>
            </span>
          <% end %>
          <% remaining = (entry.keys&.length || 0) - 5 %>
          <% if remaining > 0 %>
            <span class="badge badge-xs badge-ghost">+<%= remaining %></span>
          <% end %>
        </div>

        <% if entry.content.present? %>
          <p class="text-xs text-base-content/50 line-clamp-1">
            <%= entry.content.truncate(100) %>
          </p>
        <% end %>

        <%# Indicators %>
        <div class="flex items-center gap-2 mt-1 text-xs text-base-content/40">
          <% if entry.selective && entry.secondary_keys.present? %>
            <span class="flex items-center gap-0.5" title="<%= t("lorebook_entries.selective_hint", default: "Has secondary keys") %>">
              <span class="icon-[lucide--filter] size-3"></span>
              <%= entry.selective_logic.humanize %>
            </span>
          <% end %>
          <% if entry.sticky.present? %>
            <span class="flex items-center gap-0.5" title="<%= t("lorebook_entries.sticky_hint", default: "Sticky for N messages") %>">
              <span class="icon-[lucide--pin] size-3"></span>
              <%= entry.sticky %>
            </span>
          <% end %>
          <% if entry.group.present? %>
            <span class="flex items-center gap-0.5" title="<%= t("lorebook_entries.group_hint", default: "Inclusion group") %>">
              <span class="icon-[lucide--users] size-3"></span>
              <%= entry.group.truncate(15) %>
            </span>
          <% end %>
          <span class="flex items-center gap-0.5">
            <span class="icon-[lucide--arrow-up-down] size-3"></span>
            <%= entry.insertion_order %>
          </span>
        </div>
      </div>

      <%# Actions %>
      <div class="flex items-center gap-1">
        <%= link_to edit_settings_lorebook_entry_path(lorebook, entry), class: "btn btn-ghost btn-xs btn-circle" do %>
          <span class="icon-[lucide--edit] size-4"></span>
        <% end %>
        <%= button_to settings_lorebook_entry_path(lorebook, entry),
            method: :delete,
            data: { turbo_confirm: t("lorebook_entries.delete_confirm", default: "Delete this entry?") },
            class: "btn btn-ghost btn-xs btn-circle text-error" do %>
          <span class="icon-[lucide--trash-2] size-4"></span>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
