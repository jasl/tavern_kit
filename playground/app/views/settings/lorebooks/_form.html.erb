<%# Lorebook Form %>
<%# locals: (lorebook:) %>
<%= form_with model: lorebook, url: lorebook.persisted? ? settings_lorebook_path(lorebook) : settings_lorebooks_path, class: "space-y-6" do |f| %>
  <% if lorebook.errors.any? %>
    <div class="alert alert-error">
      <span class="icon-[lucide--alert-circle] size-5"></span>
      <div>
        <h3 class="font-bold"><%= t("common.errors_title", default: "Please fix the following errors:") %></h3>
        <ul class="list-disc list-inside text-sm">
          <% lorebook.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <!-- Name -->
  <div class="form-control">
    <label class="label py-1">
      <span class="label-text font-medium"><%= t("lorebooks.form.name", default: "Name") %> <span class="text-error">*</span></span>
    </label>
    <%= f.text_field :name, class: "input input-bordered w-full", required: true, placeholder: t("lorebooks.form.name_placeholder", default: "My World Info") %>
  </div>

  <!-- Description -->
  <div class="form-control">
    <label class="label py-1">
      <span class="label-text font-medium"><%= t("lorebooks.form.description", default: "Description") %></span>
    </label>
    <%= f.text_area :description, class: "textarea textarea-bordered w-full h-24", placeholder: t("lorebooks.form.description_placeholder", default: "Optional description of this lorebook...") %>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Scan Depth -->
    <div class="form-control">
      <label class="label py-1">
        <span class="label-text font-medium"><%= t("lorebooks.form.scan_depth", default: "Scan Depth") %></span>
      </label>
      <%= f.number_field :scan_depth, class: "input input-bordered w-full", min: 0, max: 1000, placeholder: "100" %>
      <label class="label py-0.5">
        <span class="label-text-alt text-base-content/50"><%= t("lorebooks.form.scan_depth_hint", default: "Number of messages to scan for keywords") %></span>
      </label>
    </div>

    <!-- Token Budget -->
    <div class="form-control">
      <label class="label py-1">
        <span class="label-text font-medium"><%= t("lorebooks.form.token_budget", default: "Token Budget") %></span>
      </label>
      <%= f.number_field :token_budget, class: "input input-bordered w-full", min: 0, max: 200000, placeholder: t("lorebooks.form.token_budget_placeholder", default: "Unlimited") %>
      <label class="label py-0.5">
        <span class="label-text-alt text-base-content/50"><%= t("lorebooks.form.token_budget_hint", default: "Maximum tokens for activated entries") %></span>
      </label>
    </div>
  </div>

  <!-- Recursive Scanning -->
  <div class="form-control">
    <label class="label cursor-pointer py-2">
      <div>
        <span class="label-text font-medium"><%= t("lorebooks.form.recursive_scanning", default: "Recursive Scanning") %></span>
        <p class="label-text-alt text-base-content/50 mt-0.5"><%= t("lorebooks.form.recursive_scanning_hint", default: "Allow entries to activate other entries by mentioning their keywords") %></p>
      </div>
      <%= f.check_box :recursive_scanning, class: "toggle toggle-primary" %>
    </label>
  </div>

  <!-- Actions -->
  <div class="flex gap-2 pt-4">
    <button type="submit" class="btn btn-primary gap-2">
      <span class="icon-[lucide--save] size-4"></span>
      <%= lorebook.persisted? ? t("common.save", default: "Save") : t("lorebooks.create", default: "Create Lorebook") %>
    </button>
    <%= link_to settings_lorebooks_path, class: "btn btn-ghost" do %>
      <%= t("common.cancel", default: "Cancel") %>
    <% end %>
  </div>
<% end %>
