<%# Range field for numeric values with min/max %>
<%# locals: (field:) %>
<%
  value = field[:value]
  value = field[:default] if value.nil?
  value = 0 if value.nil?

  range = field[:range] || {}
  min_val = range["min"] || field[:minimum] || 0
  max_val = range["max"] || field[:maximum] || 100
  step_val = range["step"] || field[:step] || (field[:type] == "integer" ? 1 : 0.01)

  disabled = field[:disabled] == true
  disabled_reason = field[:disabled_reason].presence
  # Support both traditional form (field_name) and AJAX mode (setting_path)
  field_name = field[:field_name]
%>

<fieldset class="fieldset setting-row <%= "opacity-50" if disabled %>"
          data-controller="range-display"
          data-schema-field="true"
          <% if field[:setting_path].present? %>data-setting-path="<%= field[:setting_path] %>"<% end %>
          data-setting-type="<%= field[:type] %>"
          data-ui-tab="<%= field[:ui_tab] %>"
          data-ui-order="<%= field[:ui_order] || 999 %>"
          data-ui-group="<%= field[:ui_group].presence || "General" %>"
          <% if field[:visible_when].present? %>data-visible-when="<%= field[:visible_when].to_json %>"<% end %>>
  <legend class="fieldset-legend">
    <span class="text-sm"><%= field[:label] %></span>
  </legend>
  <div class="flex items-center gap-3">
    <input type="range"
           <% if field_name.present? %>name="<%= field_name %>"<% end %>
           class="range range-primary range-sm flex-1"
           min="<%= min_val %>"
           max="<%= max_val %>"
           step="<%= step_val %>"
           value="<%= value %>"
           data-range-display-target="slider"
           data-action="input->range-display#updateFromSlider"
           <%= "disabled" if disabled %>
           <%= "data-schema-disabled=true" if disabled %> />
    <input type="number"
           class="input input-sm input-bordered font-mono text-sm w-20 text-center tabular-nums"
           min="<%= min_val %>"
           max="<%= max_val %>"
           step="<%= step_val %>"
           value="<%= value %>"
           data-range-display-target="number"
           data-action="input->range-display#updateFromNumber blur->range-display#validateOnBlur"
           data-setting-key="<%= field[:key] %>"
           data-setting-type="<%= field[:type] %>"
           <% if field[:setting_path].present? %>data-setting-path="<%= field[:setting_path] %>"<% end %>
           <%= "disabled" if disabled %>
           <%= "data-schema-disabled=true" if disabled %> />
  </div>
  <div class="flex justify-between text-xs text-base-content/50 px-0.5 mt-0.5">
    <span><%= min_val %></span>
    <span><%= max_val %></span>
  </div>

  <% if field[:description].present? %>
    <p class="text-xs text-base-content/60 mt-1"><%= field[:description] %></p>
  <% end %>

  <% if disabled_reason %>
    <p class="text-xs text-base-content/60 mt-1">Disabled: <%= disabled_reason %></p>
  <% end %>
</fieldset>
