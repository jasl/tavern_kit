<%# Typing indicator for AI generation feedback with streaming content %>
<%# locals: (conversation:) %>
<%#
  Uses the unified conversation-channel controller which handles:
  - typing_start: Show indicator with correct avatar
  - typing_stop: Hide indicator
  - stream_chunk: Update streaming content
  - stream_complete: Clear and hide

  The indicator dynamically updates its styling based on who is typing.
%>
<div id="typing_indicator"
     class="mes hidden animate-fade-in"
     data-conversation-channel-target="typingIndicator">

  <%# Avatar wrapper - dynamically updated from JavaScript %>
  <div class="mes-avatar-wrapper" data-conversation-channel-target="typingAvatar">
    <img data-conversation-channel-target="typingAvatarImg"
         class="avatar"
         src="<%= image_path('default_portrait.png') %>"
         alt="AI" />
  </div>

  <%# Message block %>
  <div class="mes-block">
    <%# Header with dynamic name %>
    <div class="mes-header">
      <span class="mes-name" data-conversation-channel-target="typingName">AI</span>
      <span class="badge badge-ghost badge-xs"><%= t("messages.typing", default: "typing") %></span>
    </div>

    <%# Message text with streaming content or loading dots %>
    <div class="mes-text" data-conversation-channel-target="typingBubble">
      <%# Streaming content (shown when generating) %>
      <div data-conversation-channel-target="typingContent"
           class="prose prose-sm max-w-none whitespace-pre-wrap break-words empty:hidden"></div>

      <%# Loading dots (shown when content is empty) %>
      <div class="typing-dots flex items-center gap-1"
           data-show-when-empty>
        <span class="loading loading-dots loading-sm"></span>
      </div>
    </div>
  </div>
</div>

<style>
  /* Hide loading dots when there's content */
  #typing_indicator [data-conversation-channel-target="typingContent"]:not(:empty) + .typing-dots {
    display: none;
  }
</style>
