<% content_for(:body_class, "h-dvh overflow-hidden bg-base-200") %>
<% content_for :content do %>
  <%= render "shared/flash" %>

  <%# Outer drawer for left sidebar %>
  <div class="drawer lg:drawer-open h-dvh" data-controller="sidebar" data-sidebar-key-value="left">
    <input id="left-drawer" type="checkbox" class="drawer-toggle" data-sidebar-target="toggle" />

    <%# Main content + right drawer wrapper %>
    <div class="drawer-content flex flex-col h-dvh overflow-hidden">
      <%# Inner drawer for right sidebar %>
      <div class="drawer drawer-end xl:drawer-open h-full" data-controller="sidebar" data-sidebar-key-value="right">
        <input id="right-drawer" type="checkbox" class="drawer-toggle" data-sidebar-target="toggle" />

        <%# Main content area %>
        <div class="drawer-content h-full flex flex-col overflow-hidden">
          <%# Chat header %>
          <header class="navbar min-h-0 h-14 px-4 bg-base-100 border-b border-base-300 shrink-0">
            <div class="navbar-start">
              <%# Mobile: Left drawer toggle %>
              <label for="left-drawer" class="btn btn-ghost btn-sm btn-square lg:hidden" aria-label="Open space panel">
                <span class="icon-[lucide--panel-left] size-5"></span>
              </label>

              <%# Branch switcher dropdown %>
              <% if @conversation %>
                <%= render "conversations/branch_dropdown",
                           conversation: @conversation,
                           tree_conversations: @tree_conversations %>
              <% end %>
            </div>

            <div class="navbar-end gap-2">
              <%# Theme toggle %>
              <label class="btn btn-ghost btn-sm btn-square swap swap-rotate" data-controller="theme">
                <input type="checkbox" data-theme-target="checkbox" data-action="change->theme#toggle" />
                <span class="icon-[lucide--sun] size-5 swap-off"></span>
                <span class="icon-[lucide--moon] size-5 swap-on"></span>
              </label>

              <%# Mobile: Right drawer toggle %>
              <label for="right-drawer" class="btn btn-ghost btn-sm btn-square xl:hidden" aria-label="Open settings">
                <span class="icon-[lucide--settings] size-5"></span>
              </label>
            </div>
          </header>

          <%# Main chat area %>
          <main class="flex-1 flex flex-col min-h-0 overflow-hidden">
            <%= yield %>
          </main>
        </div>

        <%# Right sidebar (Settings) %>
        <div class="drawer-side z-40 h-full">
          <label for="right-drawer" aria-label="Close settings" class="drawer-overlay"></label>
          <aside class="w-96 max-w-[85vw] h-full bg-base-100 flex flex-col border-l border-base-300 overflow-hidden">
            <%= yield :right_sidebar %>
          </aside>
        </div>
      </div>
    </div>

    <%# Left sidebar (Space/Members) %>
    <div class="drawer-side z-50 h-full">
      <label for="left-drawer" aria-label="Close space panel" class="drawer-overlay"></label>
      <aside class="w-80 max-w-[85vw] h-full bg-base-100 flex flex-col border-r border-base-300 overflow-hidden">
        <%= yield :left_sidebar %>
      </aside>
    </div>
  </div>
<% end %>

<%= render template: "layouts/base" %>
