<%# Entry Row - Compact display in list %>
<%# locals: (entry:, lorebook:, editable: false) %>
<%= tag.div id: dom_id(entry), class: "card bg-base-200 shadow-sm", data: editable ? { sortable_item: "", entry_id: entry.id } : {} do %>
  <div class="card-body p-3">
    <div class="flex items-start gap-3">
      <% if editable %>
        <%# Drag Handle %>
        <div class="cursor-grab text-base-content/30 hover:text-base-content/50 pt-1" data-sortable-handle="">
          <span class="icon-[lucide--grip-vertical] size-4"></span>
        </div>

        <%# Toggle & Status %>
        <div class="flex flex-col items-center gap-1">
          <%= form_with model: entry, url: lorebook_entry_path(lorebook, entry), method: :patch, class: "inline" do |f| %>
            <%= f.check_box :enabled,
                class: "toggle toggle-sm toggle-primary",
                onchange: "this.form.requestSubmit()",
                data: { turbo_frame: dom_id(entry) } %>
          <% end %>
          <% if entry.constant %>
            <span class="badge badge-xs badge-warning" title="<%= t("lorebook_entries.constant_hint", default: "Always active") %>">C</span>
          <% end %>
        </div>
      <% else %>
        <%# Status badges for read-only view %>
        <div class="flex flex-col items-center gap-1 pt-1">
          <% if entry.enabled %>
            <span class="badge badge-xs badge-success" title="<%= t("common.enabled", default: "Enabled") %>">
              <span class="icon-[lucide--check] size-3"></span>
            </span>
          <% else %>
            <span class="badge badge-xs badge-ghost" title="<%= t("common.disabled", default: "Disabled") %>">
              <span class="icon-[lucide--x] size-3"></span>
            </span>
          <% end %>
          <% if entry.constant %>
            <span class="badge badge-xs badge-warning" title="<%= t("lorebook_entries.constant_hint", default: "Always active") %>">C</span>
          <% end %>
        </div>
      <% end %>

      <%# Content Preview %>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 mb-1">
          <span class="font-medium text-sm truncate"><%= entry.display_name %></span>
          <span class="badge badge-xs badge-ghost">
            <%= entry.position.humanize %>
          </span>
          <% if entry.probability < 100 %>
            <span class="badge badge-xs badge-outline" title="<%= t("lorebook_entries.probability_hint", default: "Activation probability") %>">
              <%= entry.probability %>%
            </span>
          <% end %>
        </div>

        <div class="flex flex-wrap gap-1 mb-1">
          <% entry.keys&.first(5)&.each do |key| %>
            <span class="badge badge-xs <%= key.start_with?('/') ? 'badge-secondary' : 'badge-primary' %> badge-outline">
              <%= key.truncate(20) %>
            </span>
          <% end %>
          <% remaining = (entry.keys&.length || 0) - 5 %>
          <% if remaining > 0 %>
            <span class="badge badge-xs badge-ghost">+<%= remaining %></span>
          <% end %>
        </div>

        <% if entry.content.present? %>
          <p class="text-xs text-base-content/50 line-clamp-1">
            <%= entry.content.truncate(100) %>
          </p>
        <% end %>

        <%# Indicators %>
        <div class="flex items-center gap-2 mt-1 text-xs text-base-content/40">
          <% if entry.selective && entry.secondary_keys.present? %>
            <span class="flex items-center gap-0.5" title="<%= t("lorebook_entries.selective_hint", default: "Has secondary keys") %>">
              <span class="icon-[lucide--filter] size-3"></span>
              <%= entry.selective_logic.humanize %>
            </span>
          <% end %>
          <% if entry.sticky.present? %>
            <span class="flex items-center gap-0.5" title="<%= t("lorebook_entries.sticky_hint", default: "Sticky for N messages") %>">
              <span class="icon-[lucide--pin] size-3"></span>
              <%= entry.sticky %>
            </span>
          <% end %>
          <% if entry.group.present? %>
            <span class="flex items-center gap-0.5" title="<%= t("lorebook_entries.group_hint", default: "Inclusion group") %>">
              <span class="icon-[lucide--users] size-3"></span>
              <%= entry.group.truncate(15) %>
            </span>
          <% end %>
          <span class="flex items-center gap-0.5">
            <span class="icon-[lucide--arrow-up-down] size-3"></span>
            <%= entry.insertion_order %>
          </span>
        </div>
      </div>

      <%# Actions %>
      <div class="flex items-center gap-1">
        <% if editable %>
          <%= link_to edit_lorebook_entry_path(lorebook, entry), class: "btn btn-ghost btn-xs gap-1" do %>
            <span class="icon-[lucide--edit] size-4"></span>
            <%= t("common.edit", default: "Edit") %>
          <% end %>
          <%= button_to lorebook_entry_path(lorebook, entry),
              method: :delete,
              data: { turbo_confirm: t("lorebook_entries.delete_confirm", default: "Delete this entry?") },
              class: "btn btn-ghost btn-xs btn-circle text-error" do %>
            <span class="icon-[lucide--trash-2] size-4"></span>
          <% end %>
        <% else %>
          <%= link_to lorebook_entry_path(lorebook, entry), class: "btn btn-ghost btn-xs gap-1" do %>
            <span class="icon-[lucide--eye] size-4"></span>
            <%= t("common.view", default: "View") %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
