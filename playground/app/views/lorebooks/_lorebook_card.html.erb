<%# Lorebook Card - Display in grid view %>
<%# locals: (lorebook:) %>
<div class="card bg-base-100 shadow-sm hover:shadow-md transition-shadow">
  <div class="card-body p-4">
    <div class="flex items-start justify-between gap-2">
      <div class="flex-1 min-w-0">
        <h3 class="card-title text-base font-semibold truncate">
          <%= link_to lorebook.name, edit_lorebook_path(lorebook), class: "hover:text-primary transition-colors" %>
        </h3>
        <% if lorebook.description.present? %>
          <p class="text-sm text-base-content/60 line-clamp-2 mt-1">
            <%= lorebook.description %>
          </p>
        <% end %>
      </div>
      <div class="dropdown dropdown-end">
        <div tabindex="0" role="button" class="btn btn-ghost btn-xs btn-circle">
          <span class="icon-[lucide--more-vertical] size-4"></span>
        </div>
        <ul tabindex="0" class="dropdown-content menu menu-sm bg-base-200 rounded-box z-10 w-40 p-2 shadow">
          <li>
            <%= link_to edit_lorebook_path(lorebook), class: "gap-2" do %>
              <span class="icon-[lucide--edit] size-4"></span>
              <%= t("common.edit", default: "Edit") %>
            <% end %>
          </li>
          <li>
            <%= link_to export_lorebook_path(lorebook), class: "gap-2" do %>
              <span class="icon-[lucide--download] size-4"></span>
              <%= t("lorebooks.export", default: "Export") %>
            <% end %>
          </li>
          <li>
            <%= link_to duplicate_lorebook_path(lorebook), method: :post, class: "gap-2" do %>
              <span class="icon-[lucide--copy] size-4"></span>
              <%= t("lorebooks.duplicate", default: "Duplicate") %>
            <% end %>
          </li>
          <li class="border-t border-base-300 mt-1 pt-1">
            <%= link_to lorebook_path(lorebook), method: :delete, data: { turbo_confirm: t("lorebooks.delete_confirm", default: "Are you sure you want to delete this lorebook?") }, class: "text-error gap-2" do %>
              <span class="icon-[lucide--trash-2] size-4"></span>
              <%= t("common.delete", default: "Delete") %>
            <% end %>
          </li>
        </ul>
      </div>
    </div>

    <div class="flex items-center gap-3 mt-3 text-xs text-base-content/50">
      <span class="flex items-center gap-1">
        <span class="icon-[lucide--list] size-3.5"></span>
        <% entries_count = lorebook.respond_to?(:entries_count) ? lorebook.entries_count : lorebook.entries.count %>
        <%= t("lorebooks.entries_count", count: entries_count, default: "%{count} entries") %>
      </span>
      <% if lorebook.token_budget.present? %>
        <span class="flex items-center gap-1">
          <span class="icon-[lucide--coins] size-3.5"></span>
          <%= number_with_delimiter(lorebook.token_budget) %> tokens
        </span>
      <% end %>
      <% if lorebook.recursive_scanning %>
        <span class="badge badge-xs badge-outline gap-1">
          <span class="icon-[lucide--repeat] size-3"></span>
          Recursive
        </span>
      <% end %>
    </div>

    <div class="card-actions justify-end mt-2">
      <%= link_to edit_lorebook_path(lorebook), class: "btn btn-ghost btn-sm gap-1" do %>
        <span class="icon-[lucide--edit] size-4"></span>
        <%= t("common.edit", default: "Edit") %>
      <% end %>
    </div>
  </div>
</div>
