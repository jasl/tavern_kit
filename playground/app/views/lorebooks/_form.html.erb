<%# Lorebook Form %>
<%# locals: (lorebook:) %>
<%= form_with model: lorebook, class: "space-y-4" do |f| %>
  <% if lorebook.errors.any? %>
    <div class="alert alert-error">
      <span class="icon-[lucide--alert-circle] size-5"></span>
      <div>
        <h3 class="font-bold"><%= t("common.errors_title", default: "Please fix the following errors:") %></h3>
        <ul class="list-disc list-inside text-sm">
          <% lorebook.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="form-control">
    <%= f.label :name, class: "label" do %>
      <span class="label-text"><%= t("lorebooks.form.name", default: "Name") %> <span class="text-error">*</span></span>
    <% end %>
    <%= f.text_field :name, class: "input input-bordered", required: true, placeholder: t("lorebooks.form.name_placeholder", default: "My World Info") %>
  </div>

  <div class="form-control">
    <%= f.label :description, class: "label" do %>
      <span class="label-text"><%= t("lorebooks.form.description", default: "Description") %></span>
    <% end %>
    <%= f.text_area :description, class: "textarea textarea-bordered h-24", placeholder: t("lorebooks.form.description_placeholder", default: "Optional description of this lorebook...") %>
  </div>

  <div class="divider text-xs text-base-content/50"><%= t("lorebooks.form.activation_settings", default: "Activation Settings") %></div>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    <div class="form-control">
      <%= f.label :scan_depth, class: "label" do %>
        <span class="label-text"><%= t("lorebooks.form.scan_depth", default: "Scan Depth") %></span>
      <% end %>
      <%= f.number_field :scan_depth, class: "input input-bordered", min: 0, max: 1000, placeholder: "2" %>
      <label class="label">
        <span class="label-text-alt text-base-content/50">
          <%= t("lorebooks.form.scan_depth_hint", default: "Messages to scan for keywords") %>
        </span>
      </label>
    </div>

    <div class="form-control">
      <%= f.label :token_budget, class: "label" do %>
        <span class="label-text"><%= t("lorebooks.form.token_budget", default: "Token Budget") %></span>
      <% end %>
      <%= f.number_field :token_budget, class: "input input-bordered", min: 0, max: 200000, placeholder: t("lorebooks.form.token_budget_placeholder", default: "Unlimited") %>
      <label class="label">
        <span class="label-text-alt text-base-content/50">
          <%= t("lorebooks.form.token_budget_hint", default: "Max tokens for activated entries") %>
        </span>
      </label>
    </div>
  </div>

  <div class="form-control">
    <label class="label cursor-pointer justify-start gap-3">
      <%= f.check_box :recursive_scanning, class: "toggle toggle-primary" %>
      <span class="label-text"><%= t("lorebooks.form.recursive_scanning", default: "Enable Recursive Scanning") %></span>
    </label>
    <label class="label pt-0">
      <span class="label-text-alt text-base-content/50">
        <%= t("lorebooks.form.recursive_scanning_hint", default: "Allow entries to activate other entries by mentioning their keywords") %>
      </span>
    </label>
  </div>

  <div class="flex justify-end gap-2 pt-4">
    <%= link_to lorebooks_path, class: "btn btn-ghost" do %>
      <%= t("common.cancel", default: "Cancel") %>
    <% end %>
    <%= f.submit lorebook.persisted? ? t("common.save", default: "Save") : t("lorebooks.create", default: "Create Lorebook"), class: "btn btn-primary" %>
  </div>
<% end %>
