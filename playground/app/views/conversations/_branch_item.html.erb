<%# Single branch/checkpoint item in the tree listing %>
<%# locals: (conv:, current_conversation:, is_root:) %>
<%
  is_current = conv.id == current_conversation.id
  message_count = conv.messages.count
%>

<% if is_current %>
  <%# Current conversation - highlighted, not a link %>
  <div class="flex items-start gap-2 p-2 rounded-lg bg-primary/10 border border-primary/20">
    <span class="<%= conversation_kind_icon(conv) %> size-4 text-primary shrink-0 mt-0.5"></span>
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-1.5">
        <span class="font-medium text-sm truncate"><%= conversation_display_label(conv) %></span>
        <span class="badge badge-xs badge-primary"><%= t("common.current", default: "Current") %></span>
      </div>
      <div class="flex items-center gap-2 mt-1 text-xs text-base-content/50">
        <span><%= message_count %> <%= t("messages.count", default: "msgs") %></span>
        <span>·</span>
        <span><%= time_ago_in_words(conv.updated_at) %></span>
      </div>
    </div>
  </div>
<% else %>
  <%# Other conversation - clickable link %>
  <%= link_to conversation_path(conv),
              class: "flex items-start gap-2 p-2 rounded-lg hover:bg-base-200 transition-colors group",
              data: { turbo_frame: "_top" } do %>
    <span class="<%= conversation_kind_icon(conv) %> size-4 text-base-content/50 group-hover:text-base-content shrink-0 mt-0.5"></span>
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-1.5">
        <span class="text-sm truncate group-hover:text-primary"><%= conversation_display_label(conv) %></span>
        <% unless is_root %>
          <span class="badge badge-xs <%= conversation_kind_badge_class(conv) %>">
            <%= conv.kind == "checkpoint" ? t("conversations.checkpoint_short", default: "CP") : t("conversations.branch_short", default: "BR") %>
          </span>
        <% end %>
      </div>
      <div class="flex items-center gap-2 mt-1 text-xs text-base-content/40">
        <span><%= message_count %> <%= t("messages.count", default: "msgs") %></span>
        <span>·</span>
        <span><%= time_ago_in_words(conv.updated_at) %></span>
      </div>
    </div>
    <span class="icon-[lucide--chevron-right] size-4 text-base-content/30 group-hover:text-base-content/60 shrink-0 mt-0.5"></span>
  <% end %>
<% end %>
