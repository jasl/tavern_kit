<%# Update the auto-without-human toggle button in the group queue %>
<%
  @conversation.increment!(:group_queue_revision)
  presenter = GroupQueuePresenter.new(conversation: @conversation, space: @space)
%>

<%= turbo_stream.replace presenter.dom_id do %>
  <%= render "messages/group_queue", presenter: presenter, render_seq: @conversation.group_queue_revision %>
<% end %>

<%# Update the message form to reflect Auto state changes (Auto without human and Auto are mutually exclusive) %>
<%= turbo_stream.replace "message_form" do %>
  <%= render "messages/form",
             conversation: @conversation,
             space: @space,
             message: @conversation.messages.new %>
<% end %>

<%# Show toast notification %>
<% if @conversation.auto_without_human_enabled? %>
  <%= turbo_stream.action :show_toast, nil,
                          partial: "shared/toast",
                          locals: {
                            message: t("conversations.auto_without_human.started",
                                       default: "Auto without human started (%{rounds} rounds)",
                                       rounds: @conversation.auto_without_human_remaining_rounds),
                            type: :success
                          } %>
<% else %>
  <%= turbo_stream.action :show_toast, nil,
                          partial: "shared/toast",
                          locals: {
                            message: t("conversations.auto_without_human.stopped", default: "Auto without human stopped"),
                            type: :info
                          } %>
<% end %>
