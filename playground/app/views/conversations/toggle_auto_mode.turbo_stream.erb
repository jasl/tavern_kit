<%# Update the auto-mode toggle button in the group queue %>
<%
  # Controller already reloads @space.space_memberships after disable_all_copilot_modes!
  @conversation.increment!(:group_queue_revision)
  presenter = GroupQueuePresenter.new(conversation: @conversation, space: @space)
%>

<%= turbo_stream.replace presenter.dom_id do %>
  <%= render "messages/group_queue", presenter: presenter, render_seq: @conversation.group_queue_revision %>
<% end %>

<%# Update the message form to reflect Copilot state changes (Auto and Copilot are mutually exclusive) %>
<%= turbo_stream.replace "message_form" do %>
  <%= render "messages/form",
             conversation: @conversation,
             space: @space,
             message: @conversation.messages.new %>
<% end %>

<%# Show toast notification %>
<% if @conversation.auto_mode_enabled? %>
  <%= turbo_stream.action :show_toast, nil,
                          partial: "shared/toast",
                          locals: {
                            message: t("conversations.auto_mode.started",
                                       default: "Auto-mode started (%{rounds} rounds)",
                                       rounds: @conversation.auto_mode_remaining_rounds),
                            type: :success
                          } %>
<% else %>
  <%= turbo_stream.action :show_toast, nil,
                          partial: "shared/toast",
                          locals: {
                            message: t("conversations.auto_mode.stopped", default: "Auto-mode stopped"),
                            type: :info
                          } %>
<% end %>
