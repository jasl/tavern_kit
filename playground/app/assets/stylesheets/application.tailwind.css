@import "tailwindcss";
@plugin "@tailwindcss/typography";
@plugin "tailwindcss-motion";
@plugin "daisyui";
@plugin "@iconify/tailwind4" {
    prefixes: lucide;
}

@theme {
    --font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", "Liberation Sans",
    "PingFang SC", "Microsoft YaHei UI", "Microsoft YaHei", "Noto Sans CJK SC", "Noto Sans SC",
    "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic UI", "Yu Gothic", "Meiryo", "Noto Sans CJK JP", "Noto Sans JP",
    "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
    --font-title: var(--font-sans);

    /* Custom spacing for navbar offset */
    --spacing-18: 4.5rem;
}

/* ===========================================
   CJK Typography Optimization
   Supports: Chinese (zh), Japanese (ja), English (en)
   =========================================== */

@layer base {
    html {
        @apply font-sans antialiased;
        text-rendering: optimizeLegibility;
    }

    /* Selection style */
    ::selection {
        @apply bg-primary/30;
    }

    /* Low-DPI screen optimization */
    @media (max-resolution: 1.5dppx) {
        html {
            @apply subpixel-antialiased;
        }
    }

    /* Pragmatic global CJK defaults:
       - Primary target: zh+en and ja+en mixed UIs
       - Goal: long tokens (URLs/model names) wrap instead of overflowing */
    :where(:lang(zh), :lang(ja)) {
        @apply wrap-break-word;
    }

    /* Slightly better underline spacing for CJK */
    :where(:lang(zh), :lang(ja)) a {
        text-underline-offset: 0.2em;
    }

    /* Chinese: looser line-breaking; optional autospace (Chromium) */
    :lang(zh) {
        line-break: loose;
    }
    @supports (text-autospace: ideograph-alpha) {
        :lang(zh) {
            text-autospace: ideograph-alpha ideograph-numeric;
        }
    }

    /* Japanese-specific text styles */
    :lang(ja) {
        line-break: strict;
        font-feature-settings: 'palt' 1, 'kern' 1;
    }

    /* Progressive enhancement: phrase-based line breaking (CSS Text L4, Chromium) */
    @supports (word-break: auto-phrase) {
        :lang(ja) {
            word-break: auto-phrase;
        }
    }

    /* English optimizations */
    :lang(en) {
        @apply hyphens-auto;
    }

    /* Ruby annotation support */
    ruby {
        ruby-align: space-between;
    }
    rt {
        font-size: 0.5em;
        font-weight: normal;
    }
}

/* ===========================================
   Custom Scrollbar - Auto-hide
   Shows on hover/scroll, hides when idle
   =========================================== */

@utility scrollbar-hide {
    /* Firefox */
    scrollbar-width: none;

    /* Safari and Chrome */
    &::-webkit-scrollbar {
        display: none;
    }
}

@utility scrollbar-default {
    /* Firefox */
    scrollbar-width: auto;

    /* Safari and Chrome */
    &::-webkit-scrollbar {
        display: block;
    }
}

@utility scrollbar-auto-hide {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    transition: scrollbar-color 0.3s ease;

    &:hover,
    &:focus-within,
    &.is-scrolling {
        scrollbar-color: oklch(var(--bc) / 0.3) transparent;
    }

    /* WebKit scrollbar styling */
    &::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }

    &::-webkit-scrollbar-track {
        background: transparent;
    }

    &::-webkit-scrollbar-thumb {
        background-color: transparent;
        border-radius: 3px;
        transition: background-color 0.3s ease;
    }

    &:hover::-webkit-scrollbar-thumb,
    &:focus-within::-webkit-scrollbar-thumb,
    &.is-scrolling::-webkit-scrollbar-thumb {
        background-color: oklch(var(--bc) / 0.3);
    }

    &::-webkit-scrollbar-thumb:hover {
        background-color: oklch(var(--bc) / 0.5);
    }
}

/* ===========================================
   Chat Bubble Typography Fix
   Ensure proper text color contrast in chat bubbles
   =========================================== */

/* Force inherit for all prose content in chat bubbles */
.chat-bubble .prose,
.chat-bubble .prose p,
.chat-bubble .prose em,
.chat-bubble .prose i,
.chat-bubble .prose strong,
.chat-bubble .prose b,
.chat-bubble .prose span,
.chat-bubble .prose blockquote,
.chat-bubble .prose li,
.chat-bubble .prose h1,
.chat-bubble .prose h2,
.chat-bubble .prose h3,
.chat-bubble .prose h4,
.chat-bubble .prose h5,
.chat-bubble .prose h6 {
    color: inherit !important;
}

/* Links inside chat bubbles - same color with underline */
.chat-bubble .prose a {
    color: inherit !important;
    text-decoration: underline;
    text-underline-offset: 2px;
}

/* Code blocks inside chat bubbles */
.chat-bubble .prose code {
    color: inherit !important;
    background-color: oklch(0% 0 0 / 0.12);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
}

.chat-bubble .prose pre {
    color: inherit !important;
    background-color: oklch(0% 0 0 / 0.15);
}

/* ===========================================
   Token Visualization - Colorized Chunks
   For prompt preview and debug views
   =========================================== */

.token-chunk {
    display: inline;
    padding: 1px 2px;
    border-radius: 2px;
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    cursor: help;
    white-space: pre-wrap;
}

/* Rotating background colors for token chunks */
.token-chunk:nth-child(4n+1) { background-color: oklch(85% 0.12 120); }
.token-chunk:nth-child(4n+2) { background-color: oklch(85% 0.12 200); }
.token-chunk:nth-child(4n+3) { background-color: oklch(85% 0.12 280); }
.token-chunk:nth-child(4n+4) { background-color: oklch(85% 0.12 40); }

/* Dark theme adjustments for token chunks */
[data-theme="dark"] .token-chunk:nth-child(4n+1) { background-color: oklch(35% 0.12 120); }
[data-theme="dark"] .token-chunk:nth-child(4n+2) { background-color: oklch(35% 0.12 200); }
[data-theme="dark"] .token-chunk:nth-child(4n+3) { background-color: oklch(35% 0.12 280); }
[data-theme="dark"] .token-chunk:nth-child(4n+4) { background-color: oklch(35% 0.12 40); }

/* Logprob token coloring - probability-based */
.logprob-token {
    display: inline;
    padding: 1px 2px;
    border-radius: 2px;
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    cursor: help;
    white-space: pre-wrap;
}

/* Color scale from red (low prob) to green (high prob) */
.logprob-token.prob-very-low { background-color: oklch(70% 0.15 25); }
.logprob-token.prob-low { background-color: oklch(75% 0.12 60); }
.logprob-token.prob-medium { background-color: oklch(80% 0.10 90); }
.logprob-token.prob-high { background-color: oklch(80% 0.12 140); }
.logprob-token.prob-very-high { background-color: oklch(75% 0.15 150); }

/* Dark theme adjustments for logprob tokens */
[data-theme="dark"] .logprob-token.prob-very-low { background-color: oklch(35% 0.15 25); }
[data-theme="dark"] .logprob-token.prob-low { background-color: oklch(38% 0.12 60); }
[data-theme="dark"] .logprob-token.prob-medium { background-color: oklch(40% 0.10 90); }
[data-theme="dark"] .logprob-token.prob-high { background-color: oklch(38% 0.12 140); }
[data-theme="dark"] .logprob-token.prob-very-high { background-color: oklch(35% 0.15 150); }

@plugin "daisyui/theme" {
    name: "dark";
    default: false;
    prefersdark: true;
    color-scheme: dark;

    --color-base-100: oklch(16% 0.06 294.42); /* #100723 */
    --color-base-200: oklch(20% 0.07 294.59); /* #180c30 */
    --color-base-300: oklch(24% 0.08 298.25); /* #24123f */
    --color-base-content: oklch(97% 0.02 302.56); /* #f8f4ff */

    --color-primary: oklch(76% 0.23 324.45); /* #f472ff */
    --color-primary-content: oklch(17% 0.07 314.12); /* #1b0425 */

    --color-secondary: oklch(85% 0.14 211.13); /* #3be4ff */
    --color-secondary-content: oklch(16% 0.03 231.89); /* #021018 */

    --color-accent: oklch(83% 0.12 66.88); /* #ffb86b */
    --color-accent-content: oklch(21% 0.03 44.41); /* #24120a */

    --color-neutral: oklch(23% 0.06 293.08); /* #1e1635 */
    --color-neutral-content: oklch(91% 0.05 297.39); /* #e3d9ff */

    --color-info: oklch(71% 0.14 254.62); /* #60a5fa */
    --color-info-content: oklch(13% 0.04 264.70); /* #020617 */

    --color-success: oklch(80% 0.18 151.71); /* #4ade80 */
    --color-success-content: oklch(26% 0.05 172.55); /* #022c22 */

    --color-warning: oklch(84% 0.16 84.43); /* #fbbf24 */
    --color-warning-content: oklch(18% 0.03 97.48); /* #161202 */

    --color-error: oklch(72% 0.17 13.43); /* #fb7185 */
    --color-error-content: oklch(16% 0.04 4.08); /* #19060b */

    --radius-selector: 2rem;
    --radius-field: 2rem;
    --radius-box: 2rem;
    --size-selector: 0.25rem;
    --size-field: 0.25rem;
    --border: 1px;

    --depth: 1;
    --noise: 1;
}

@plugin "daisyui/theme" {
    name: "light";
    default: true;       /* Use light as default */
    prefersdark: false;
    color-scheme: light;

    --color-base-100: oklch(97% 0.01 277.07); /* #f3f5ff */
    --color-base-200: oklch(94% 0.03 261.48); /* #e1ecff */
    --color-base-300: oklch(88% 0.06 274.61); /* #cbd5ff */
    --color-base-content: oklch(28% 0.03 256.85); /* #1f2937 */

    --color-primary: oklch(66% 0.25 310.13); /* #c056ff */
    --color-primary-content: oklch(98% 0.01 317.74); /* #fdf7ff */

    --color-secondary: oklch(77% 0.15 229.34); /* #22c5ff */
    --color-secondary-content: oklch(18% 0.03 218.48); /* #04151a */

    --color-accent: oklch(79% 0.13 48.50); /* #ff9f6b */
    --color-accent-content: oklch(20% 0.06 35.90); /* #2b0b04 */

    --color-neutral: oklch(21% 0.03 264.66); /* #111827 */
    --color-neutral-content: oklch(98% 0.00 247.84); /* #f9fafb */

    --color-info: oklch(55% 0.22 262.88); /* #2563eb */
    --color-info-content: oklch(97% 0.01 254.60); /* #eff6ff */

    --color-success: oklch(63% 0.17 149.21); /* #16a34a */
    --color-success-content: oklch(98% 0.02 160.24); /* #ecfdf3 */

    --color-warning: oklch(77% 0.16 70.08); /* #f59e0b */
    --color-warning-content: oklch(20% 0.04 76.45); /* #1f1302 */

    --color-error: oklch(59% 0.22 17.58); /* #e11d48 */
    --color-error-content: oklch(97% 0.01 343.20); /* #fdf2f8 */

    --radius-selector: 2rem;
    --radius-field: 2rem;
    --radius-box: 2rem;
    --size-selector: 0.25rem;
    --size-field: 0.25rem;
    --border: 1px;

    --depth: 1;
    --noise: 1;
}
