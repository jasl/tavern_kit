@import "tailwindcss";
@plugin "@tailwindcss/typography";
@plugin "tailwindcss-motion";
@plugin "daisyui";
@plugin "@iconify/tailwind4" {
    prefixes: lucide;
}

@theme {
    --font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", "Liberation Sans",
    "PingFang SC", "Microsoft YaHei UI", "Microsoft YaHei", "Noto Sans CJK SC", "Noto Sans SC",
    "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic UI", "Yu Gothic", "Meiryo", "Noto Sans CJK JP", "Noto Sans JP",
    "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
    --font-title: var(--font-sans);

    /* Custom spacing for navbar offset */
    --spacing-18: 4.5rem;
}

/* ===========================================
   CJK Typography Optimization
   Supports: Chinese (zh), Japanese (ja), English (en)
   =========================================== */

@layer base {
    html {
        @apply font-sans antialiased;
        text-rendering: optimizeLegibility;
    }

    /* Selection style */
    ::selection {
        @apply bg-primary/30;
    }

    /* Low-DPI screen optimization */
    @media (max-resolution: 1.5dppx) {
        html {
            @apply subpixel-antialiased;
        }
    }

    /* Pragmatic global CJK defaults:
       - Primary target: zh+en and ja+en mixed UIs
       - Goal: long tokens (URLs/model names) wrap instead of overflowing */
    :where(:lang(zh), :lang(ja)) {
        @apply wrap-break-word;
    }

    /* Slightly better underline spacing for CJK */
    :where(:lang(zh), :lang(ja)) a {
        text-underline-offset: 0.2em;
    }

    /* Chinese: looser line-breaking; optional autospace (Chromium) */
    :lang(zh) {
        line-break: loose;
    }
    @supports (text-autospace: ideograph-alpha) {
        :lang(zh) {
            text-autospace: ideograph-alpha ideograph-numeric;
        }
    }

    /* Japanese-specific text styles */
    :lang(ja) {
        line-break: strict;
        font-feature-settings: 'palt' 1, 'kern' 1;
    }

    /* Progressive enhancement: phrase-based line breaking (CSS Text L4, Chromium) */
    @supports (word-break: auto-phrase) {
        :lang(ja) {
            word-break: auto-phrase;
        }
    }

    /* English optimizations */
    :lang(en) {
        @apply hyphens-auto;
    }

    /* Ruby annotation support */
    ruby {
        ruby-align: space-between;
    }
    rt {
        font-size: 0.5em;
        font-weight: normal;
    }
}

/* ===========================================
   Custom Scrollbar - Auto-hide
   Shows on hover/scroll, hides when idle
   =========================================== */

@utility scrollbar-hide {
    /* Firefox */
    scrollbar-width: none;

    /* Safari and Chrome */
    &::-webkit-scrollbar {
        display: none;
    }
}

@utility scrollbar-default {
    /* Firefox */
    scrollbar-width: auto;

    /* Safari and Chrome */
    &::-webkit-scrollbar {
        display: block;
    }
}

@utility scrollbar-none {
    scrollbar-width: none;
    -ms-overflow-style: none;

    &::-webkit-scrollbar {
        display: none;
    }
}
@utility scrollbar-auto-hide {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    transition: scrollbar-color 0.3s ease;

    &:hover,
    &:focus-within,
    &.is-scrolling {
        scrollbar-color: oklch(from var(--color-base-content) l c h / 0.3) transparent;
    }

    /* WebKit scrollbar styling */
    &::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }

    &::-webkit-scrollbar-track {
        background: transparent;
    }

    &::-webkit-scrollbar-thumb {
        background-color: transparent;
        border-radius: 3px;
        transition: background-color 0.3s ease;
    }

    &:hover::-webkit-scrollbar-thumb,
    &:focus-within::-webkit-scrollbar-thumb,
    &.is-scrolling::-webkit-scrollbar-thumb {
        background-color: oklch(from var(--color-base-content) l c h / 0.3);
    }

    &::-webkit-scrollbar-thumb:hover {
        background-color: oklch(from var(--color-base-content) l c h / 0.5);
    }
}

/* ===========================================
   SillyTavern-Style Message Layout
   Full-width messages with roleplay typography
   =========================================== */

/* Message container - flex row with avatar and content */
.mes {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem 0;
    position: relative;
    width: 100%;
}

/* Ensure hidden class works with mes (Tailwind's hidden uses display:none but .mes sets display:flex) */
.mes.hidden {
    display: none;
}

/* Avatar wrapper */
.mes-avatar-wrapper {
    flex-shrink: 0;
    width: 3rem;
    height: 3rem;
}

.mes-avatar-wrapper .avatar {
    width: 3rem;
    height: 3rem;
    border-radius: 9999px;
    object-fit: cover;
    cursor: pointer;
    transition: transform 0.15s ease;
}

.mes-avatar-wrapper .avatar:hover {
    transform: scale(1.05);
}

/* Message block - contains header and text */
.mes-block {
    flex: 1;
    min-width: 0;
}

/* Message header - name and timestamp */
.mes-header {
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
    flex-wrap: wrap;
}

.mes-name {
    font-weight: 700;
}

.mes-timestamp {
    font-size: 0.75rem;
    opacity: 0.5;
}

/* Message text - roleplay typography */
.mes-text {
    line-height: 1.6;
}

/* ST-style roleplay text colors - using DaisyUI theme variables
   Fallback first, then a softer theme-aware mix (better harmony + readability). */
.mes-text em,
.mes-text i {
    color: var(--color-accent);
    font-style: italic;
}

.mes-text q {
    color: var(--color-warning);
    quotes: none;
}

.mes-text q::before,
.mes-text q::after {
    content: '';
}

.mes-text u {
    color: var(--color-secondary);
    text-decoration: underline;
    text-underline-offset: 2px;
}

@supports (color: color-mix(in oklch, white, black)) {
    .mes-text em,
    .mes-text i {
        color: color-mix(in oklch, var(--color-accent) 85%, var(--color-base-content));
    }

    .mes-text q {
        color: color-mix(in oklch, var(--color-warning) 82%, var(--color-base-content));
    }

    .mes-text u {
        color: color-mix(in oklch, var(--color-secondary) 85%, var(--color-base-content));
    }
}

/* Code blocks in messages */
.mes-text code {
    background-color: oklch(from var(--color-base-300) l c h / 0.5);
    padding: 0.125rem 0.375rem;
    border-radius: calc(var(--radius-selector) / 2);
    font-size: 0.875em;
}

.mes-text pre {
    background-color: oklch(from var(--color-base-300) l c h / 0.5);
    padding: 0.75rem;
    border-radius: var(--radius-box);
    overflow-x: auto;
}

.mes-text pre code {
    background: none;
    padding: 0;
}

/* Blockquotes in messages */
.mes-text blockquote {
    border-left: 3px solid var(--color-warning);
    padding-left: 0.75rem;
    margin: 0.5rem 0;
    opacity: 0.9;
}

/* Message footer - actions and swipe navigation */
.mes-footer {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
    min-height: 1.5rem;
}

/* Swipe navigation styling */
.mes-swipe-nav {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.mes-swipe-counter {
    font-size: 0.75rem;
    opacity: 0.6;
    min-width: 2.5rem;
    text-align: center;
    font-variant-numeric: tabular-nums;
}

/* Message actions - show on hover */
.mes-actions {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    opacity: 0;
    transition: opacity 0.15s ease;
}

.mes:hover .mes-actions,
.mes:focus-within .mes-actions {
    opacity: 1;
}

/* Excluded message styling */
.mes.excluded {
    opacity: 0.5;
}

/* Error state */
.mes.errored .mes-text {
    color: var(--color-error);
}

/* ===========================================
   Typography (Tailwind Typography / .prose)
   Make markdown colors follow DaisyUI theme vars
   =========================================== */

.prose-theme {
    --tw-prose-body: oklch(from var(--color-base-content) l c h / 0.92);
    --tw-prose-headings: oklch(from var(--color-base-content) l c h / 0.98);
    --tw-prose-lead: oklch(from var(--color-base-content) l c h / 0.82);
    --tw-prose-links: var(--color-secondary);
    --tw-prose-bold: oklch(from var(--color-base-content) l c h / 0.98);
    --tw-prose-counters: oklch(from var(--color-base-content) l c h / 0.65);
    --tw-prose-bullets: oklch(from var(--color-base-content) l c h / 0.35);
    --tw-prose-hr: oklch(from var(--color-base-300) l c h / 0.7);
    --tw-prose-quotes: oklch(from var(--color-base-content) l c h / 0.88);
    --tw-prose-quote-borders: oklch(from var(--color-warning) l c h / 0.65);
    --tw-prose-captions: oklch(from var(--color-base-content) l c h / 0.6);
    --tw-prose-code: oklch(from var(--color-base-content) l c h / 0.95);
    --tw-prose-pre-code: oklch(from var(--color-base-content) l c h / 0.95);
    --tw-prose-pre-bg: oklch(from var(--color-base-300) l c h / 0.45);
    --tw-prose-th-borders: oklch(from var(--color-base-300) l c h / 0.7);
    --tw-prose-td-borders: oklch(from var(--color-base-300) l c h / 0.5);
}

.prose-theme a {
    text-underline-offset: 0.18em;
}

/* ===========================================
   Token Visualization - Colorized Chunks
   For prompt preview and debug views
   =========================================== */

.token-chunk {
    display: inline;
    padding: 1px 2px;
    border-radius: calc(var(--radius-selector) / 2);
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    cursor: help;
    white-space: pre-wrap;
}

/* Rotating background colors for token chunks (theme-aware, subtle) */
.token-chunk:nth-child(4n+1) { background-color: oklch(from var(--color-primary) l c h / 0.16); }
.token-chunk:nth-child(4n+2) { background-color: oklch(from var(--color-secondary) l c h / 0.14); }
.token-chunk:nth-child(4n+3) { background-color: oklch(from var(--color-accent) l c h / 0.14); }
.token-chunk:nth-child(4n+4) { background-color: oklch(from var(--color-warning) l c h / 0.14); }

@supports (color: color-mix(in oklch, white, black)) {
    .token-chunk:nth-child(4n+1) { background-color: color-mix(in oklch, var(--color-primary) 16%, var(--color-base-200)); }
    .token-chunk:nth-child(4n+2) { background-color: color-mix(in oklch, var(--color-secondary) 16%, var(--color-base-200)); }
    .token-chunk:nth-child(4n+3) { background-color: color-mix(in oklch, var(--color-accent) 16%, var(--color-base-200)); }
    .token-chunk:nth-child(4n+4) { background-color: color-mix(in oklch, var(--color-warning) 16%, var(--color-base-200)); }
}

/* Logprob token coloring - probability-based */
.logprob-token {
    display: inline;
    padding: 1px 2px;
    border-radius: calc(var(--radius-selector) / 2);
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    cursor: help;
    white-space: pre-wrap;
}

/* Color scale from red (low prob) to green (high prob) */
.logprob-token.prob-very-low { background-color: oklch(70% 0.15 25); }
.logprob-token.prob-low { background-color: oklch(75% 0.12 60); }
.logprob-token.prob-medium { background-color: oklch(80% 0.10 90); }
.logprob-token.prob-high { background-color: oklch(80% 0.12 140); }
.logprob-token.prob-very-high { background-color: oklch(75% 0.15 150); }

/* Dark theme adjustments for logprob tokens */
[data-theme="dark"] .logprob-token.prob-very-low { background-color: oklch(35% 0.15 25); }
[data-theme="dark"] .logprob-token.prob-low { background-color: oklch(38% 0.12 60); }
[data-theme="dark"] .logprob-token.prob-medium { background-color: oklch(40% 0.10 90); }
[data-theme="dark"] .logprob-token.prob-high { background-color: oklch(38% 0.12 140); }
[data-theme="dark"] .logprob-token.prob-very-high { background-color: oklch(35% 0.15 150); }

@plugin "daisyui/theme" {
    name: "dark";
    default: false;
    prefersdark: true;
    color-scheme: dark;

    /* Base surfaces: deep navy-slate, clear panel separation */
    --color-base-100: oklch(18% 0.018 255); /* #0c1219 */
    --color-base-200: oklch(24% 0.018 255); /* #1a2028 */
    --color-base-300: oklch(32% 0.018 255); /* #2d333c */
    --color-base-content: oklch(88% 0.012 275); /* #d5d7e0 */

    /* Brand / semantic colors: vivid-but-soft for long sessions */
    --color-primary: oklch(72% 0.16 285); /* #9c93ff */
    --color-primary-content: oklch(18% 0.018 255); /* #0c1219 */
    --color-secondary: oklch(74% 0.12 220); /* #39bcdf */
    --color-secondary-content: oklch(18% 0.018 255); /* #0c1219 */
    --color-accent: oklch(72% 0.13 350); /* #e181b0 */
    --color-accent-content: oklch(18% 0.018 255); /* #0c1219 */
    --color-neutral: oklch(22% 0.012 255); /* #171b20 */
    --color-neutral-content: oklch(88% 0.012 275); /* #d5d7e0 */
    --color-info: oklch(74% 0.12 255); /* #75aef5 */
    --color-info-content: oklch(18% 0.018 255); /* #0c1219 */
    --color-success: oklch(74% 0.11 150); /* #76be86 */
    --color-success-content: oklch(18% 0.018 255); /* #0c1219 */
    --color-warning: oklch(76% 0.12 80); /* #d9a850 */
    --color-warning-content: oklch(18% 0.018 255); /* #0c1219 */
    --color-error: oklch(72% 0.14 25); /* #f07f77 */
    --color-error-content: oklch(18% 0.018 255); /* #0c1219 */

    /* Shape + sizing */
    --radius-selector: 0.875rem;
    --radius-field: 0.875rem;
    --radius-box: 1rem;
    --size-selector: 0.25rem;
    --size-field: 0.25rem;
    --border: 1px;

    /* Effects */
    --depth: 1;
    --noise: 0;
}

@plugin "daisyui/theme" {
    name: "light";
    default: true;       /* Use light as default */
    prefersdark: false;
    color-scheme: light;

    /* Base surfaces: cool-neutral, low glare */
    --color-base-100: oklch(98% 0.006 270); /* #f7f8fd */
    --color-base-200: oklch(95% 0.010 270); /* #eceef5 */
    --color-base-300: oklch(90% 0.016 270); /* #dadee9 */
    --color-base-content: oklch(30% 0.02 260); /* #282e38 */

    /* Brand / semantic colors: slightly more lively, still WCAG-friendly */
    --color-primary: oklch(55% 0.20 285); /* #6b55df */
    --color-primary-content: oklch(98% 0.006 270); /* #f7f8fd */
    --color-secondary: oklch(53% 0.12 220); /* #007a9b */
    --color-secondary-content: oklch(98% 0.006 270); /* #f7f8fd */
    --color-accent: oklch(52% 0.16 345); /* #a5397e */
    --color-accent-content: oklch(98% 0.006 270); /* #f7f8fd */
    --color-neutral: oklch(26% 0.02 260); /* #1e242e */
    --color-neutral-content: oklch(98% 0.006 270); /* #f7f8fd */
    --color-info: oklch(55% 0.16 255); /* #2171cc */
    --color-info-content: oklch(98% 0.006 270); /* #f7f8fd */
    --color-success: oklch(50% 0.14 150); /* #007834 */
    --color-success-content: oklch(98% 0.006 270); /* #f7f8fd */
    --color-warning: oklch(54% 0.13 80); /* #956400 */
    --color-warning-content: oklch(98% 0.006 270); /* #f7f8fd */
    --color-error: oklch(52% 0.18 25); /* #ba2b2e */
    --color-error-content: oklch(98% 0.006 270); /* #f7f8fd */

    /* Shape + sizing */
    --radius-selector: 0.875rem;
    --radius-field: 0.875rem;
    --radius-box: 1rem;
    --size-selector: 0.25rem;
    --size-field: 0.25rem;
    --border: 1px;

    /* Effects */
    --depth: 1;
    --noise: 0;
}
